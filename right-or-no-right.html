<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Game 2 — Right or No Right? (Sub-Rights + 14th)</title>
  <style>
    :root{
      --bg:#0b1220;
      --card:#111a2e;
      --ink:#eaf0ff;
      --muted:#a9b4d0;
      --accent:#7dd3fc;
      --good:#34d399;
      --bad:#fb7185;
      --warn:#fbbf24;
      --line:rgba(255,255,255,.12);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 30% 10%, rgba(125,211,252,.18), transparent 60%),
                  radial-gradient(1000px 700px at 70% 20%, rgba(52,211,153,.14), transparent 55%),
                  radial-gradient(900px 700px at 60% 80%, rgba(251,113,133,.10), transparent 55%),
                  var(--bg);
      color:var(--ink);
      min-height:100vh;
      display:flex;
      flex-direction:column;
    }
    header{
      padding:16px 18px;
      border-bottom:1px solid var(--line);
      background: rgba(0,0,0,.15);
      backdrop-filter: blur(8px);
      position:sticky;
      top:0;
      z-index:10;
    }
    .nav{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      max-width:1100px;
      margin:0 auto;
    }
    .nav .left{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .badge{
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
    }
    a.navlink{
      color:var(--ink);
      text-decoration:none;
      padding:8px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      font-weight:600;
      font-size:13px;
      opacity:.9;
    }
    a.navlink:hover{opacity:1;border-color:rgba(125,211,252,.45)}
    main{
      width:100%;
      max-width:1100px;
      margin:18px auto 28px;
      padding:0 16px 24px;
      flex:1;
    }
    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:16px;
    }
    @media (max-width: 900px){
      .grid{grid-template-columns:1fr}
    }
    .card{
      background: rgba(17,26,46,.92);
      border:1px solid var(--line);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding:16px;
    }
    h1{
      margin:0 0 10px;
      font-size:22px;
      letter-spacing:.2px;
    }
    .sub{
      color:var(--muted);
      margin:0 0 12px;
      line-height:1.4;
      font-size:14px;
    }
    .metaRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .stat{
      border:1px solid var(--line);
      border-radius: 14px;
      padding:10px 12px;
      min-width:150px;
      flex:1;
    }
    .stat .k{
      color:var(--muted);
      font-size:12px;
      margin-bottom:4px;
    }
    .stat .v{
      font-size:16px;
      font-weight:800;
    }
    .prompt{
      border:1px dashed rgba(255,255,255,.22);
      border-radius: 14px;
      padding:14px;
      margin-top:12px;
      line-height:1.5;
      font-size:15px;
      background: rgba(0,0,0,.18);
    }
    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top:12px;
    }
    button{
      cursor:pointer;
      border-radius: 14px;
      border:1px solid var(--line);
      padding:10px 12px;
      background: rgba(255,255,255,.06);
      color: var(--ink);
      font-weight:700;
      letter-spacing:.2px;
    }
    button:hover{border-color: rgba(125,211,252,.45)}
    button:disabled{
      opacity:.5;
      cursor:not-allowed;
    }
    .choiceGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top:12px;
    }
    .choice{
      text-align:left;
      padding:12px;
      border-radius: 14px;
      background: rgba(255,255,255,.05);
      border:1px solid var(--line);
      transition: transform .05s ease;
    }
    .choice:hover{border-color: rgba(125,211,252,.45)}
    .choice:active{transform: scale(.99)}
    .choice small{color:var(--muted); display:block; margin-top:4px; font-weight:600}
    .msg{
      margin-top:10px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
      color: var(--muted);
    }
    .msg.good{border-color: rgba(52,211,153,.45); color: var(--ink)}
    .msg.bad{border-color: rgba(251,113,133,.55); color: var(--ink)}
    .msg.warn{border-color: rgba(251,191,36,.55); color: var(--ink)}
    .explain{
      margin-top:10px;
      border-radius: 14px;
      border:1px solid var(--line);
      padding:12px;
      background: rgba(0,0,0,.22);
      line-height:1.45;
    }
    .explain h3{
      margin:0 0 8px;
      font-size:14px;
      color: var(--accent);
      letter-spacing:.2px;
    }
    .explain ul{
      margin:0;
      padding-left:18px;
    }
    .explain li{margin:6px 0}
    .filters{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .filterBox{
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px;
      background: rgba(255,255,255,.04);
    }
    .filterBox h2{
      margin:0 0 8px;
      font-size:14px;
      color: var(--accent);
    }
    .checkRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    label.chk{
      display:flex;
      gap:8px;
      align-items:center;
      font-size:13px;
      color: var(--ink);
      padding:6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.16);
      user-select:none;
    }
    label.chk input{accent-color: var(--accent)}
    .tiny{
      font-size:12px;
      color: var(--muted);
      line-height:1.35;
      margin-top:8px;
    }
    .footerNote{
      margin-top:12px;
      color: var(--muted);
      font-size:12px;
      line-height:1.4;
    }

    /* Name modal */
    .overlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:flex; align-items:center; justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal{
      width:min(560px, 100%);
      background: rgba(17,26,46,.98);
      border:1px solid var(--line);
      box-shadow: var(--shadow);
      border-radius: 18px;
      padding:16px;
    }
    .modal h2{margin:0 0 6px; font-size:18px}
    .modal p{margin:0 0 12px; color:var(--muted); font-size:13px; line-height:1.4}
    .fieldRow{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    input[type="text"]{
      flex:1;
      min-width: 220px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
      color: var(--ink);
      font-weight:700;
      outline:none;
    }
    input[type="text"]:focus{border-color: rgba(125,211,252,.55)}
    .miniStats{
      margin-top:10px;
      display:grid;
      grid-template-columns: 1fr;
      gap:8px;
      color:var(--muted);
      font-size:12px;
    }
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}
  </style>
</head>
<body>

  <!-- Name entry overlay -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h2>Enter Your Name</h2>
      <p>This is required for your screenshot submission. The game will record start and finish timestamps.</p>
      <div class="fieldRow">
        <input id="studentName" type="text" placeholder="First + Last name" autocomplete="off" />
        <button id="beginBtn">Begin</button>
      </div>
      <div class="miniStats">
        <div>Start Time: <span class="mono" id="previewStart">—</span></div>
        <div>Finish Time: <span class="mono" id="previewFinish">—</span></div>
      </div>
      <div class="tiny">Tip: After finishing, take a screenshot of the completion summary.</div>
    </div>
  </div>

  <header>
    <div class="nav">
      <div class="left">
        <span class="badge">Bill of Rights Games</span>
        <a class="navlink" href="index.html">Home</a>
        <a class="navlink" href="right-or-no-right.html">Game 2</a>
        <a class="navlink" href="fix-the-violation.html">Game 3</a>
        <a class="navlink" href="amendment-blitz.html">Game 4</a>
      </div>
      <span class="badge">Strict Mode • Sub-Rights • 14th Added</span>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="card">
        <h1>Game 2 — Right or No Right?</h1>
        <p class="sub">
          Identify the <b>most precise constitutional “sub-right / part”</b> (or choose <b>No Right</b> when nothing in the Bill of Rights/14th applies).
          <br/>Strict mode: you must answer correctly to move on.
        </p>

        <div class="metaRow">
          <div class="stat">
            <div class="k">Student</div>
            <div class="v" id="nameDisplay">—</div>
          </div>
          <div class="stat">
            <div class="k">Timer</div>
            <div class="v" id="timer">00:00</div>
          </div>
          <div class="stat">
            <div class="k">Start</div>
            <div class="v mono" id="startStamp">—</div>
          </div>
          <div class="stat">
            <div class="k">Finish</div>
            <div class="v mono" id="finishStamp">—</div>
          </div>
        </div>

        <div class="metaRow">
          <div class="stat">
            <div class="k">Question</div>
            <div class="v"><span id="qNum">1</span> / <span id="qTotal">0</span></div>
          </div>
          <div class="stat">
            <div class="k">Attempts (this question)</div>
            <div class="v" id="attemptsQ">0</div>
          </div>
          <div class="stat">
            <div class="k">Total Attempts</div>
            <div class="v" id="attemptsTotal">0</div>
          </div>
        </div>

        <div class="prompt" id="prompt"></div>

        <div class="choiceGrid" id="choices"></div>

        <div class="msg" id="msg">Choose the most precise match.</div>

        <div class="explain" id="explain" style="display:none;">
          <h3>Post-Correct Explanation</h3>
          <ul id="explainList"></ul>
        </div>

        <div class="controls">
          <button id="restartBtn">Restart</button>
          <button id="skipBtn" title="Teacher use only: skip to the next prompt (does not count as correct)">Teacher Skip</button>
          <button id="nextBtn" disabled>Next (unlocked after correct)</button>
        </div>

        <div class="footerNote">
          Choices are limited per question to reduce scrolling (Correct + best distractors + No Right when appropriate).
        </div>
      </section>

      <aside class="card filters">
        <div class="filterBox">
          <h2>Filters (Optional)</h2>
          <div class="checkRow" id="filterRow"></div>
          <div class="tiny">
            Filters control which question bank is used when you press <b>Restart</b>.
          </div>
        </div>

        <div class="filterBox">
          <h2>Answer Key Precision</h2>
          <div class="tiny">
            You’re matching the most precise “part” available:
            <br/>• <b>1A</b> = Speech / Press / Religion / Assembly / Petition
            <br/>• <b>4A</b> = Search vs Seizure vs Warrant/Probable Cause
            <br/>• <b>5A</b> = Self-Incrimination vs Double Jeopardy (+ Due Process where appropriate)
            <br/>• <b>6A</b> = Speedy / Public / Jury / Charges / Confrontation / Counsel
            <br/>• <b>8A</b> = Cruel & Unusual / Excessive Bail / Excessive Fines
            <br/>• <b>10A</b> = Reserved Powers
            <br/>• <b>14A</b> = Citizenship / Due Process (state) / Equal Protection / Incorporation
          </div>
        </div>

        <div class="filterBox">
          <h2>Strict Mode</h2>
          <div class="tiny">
            Wrong answer → attempt counts → you must try again.
            <br/>Correct answer → explanation appears → Next unlocks.
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script>
    // -----------------------------
    // Sub-right taxonomy (answer targets)
    // -----------------------------
    const TARGETS = [
      // 1A
      { key:"1A-SPEECH", label:"1A — Freedom of Speech", amend:"1A", group:"1A", short:"Speech" },
      { key:"1A-PRESS", label:"1A — Freedom of the Press", amend:"1A", group:"1A", short:"Press" },
      { key:"1A-RELIGION", label:"1A — Freedom of Religion (Establishment/Free Exercise)", amend:"1A", group:"1A", short:"Religion" },
      { key:"1A-ASSEMBLY", label:"1A — Freedom of Assembly", amend:"1A", group:"1A", short:"Assembly" },
      { key:"1A-PETITION", label:"1A — Right to Petition Government", amend:"1A", group:"1A", short:"Petition" },

      // 4A
      { key:"4A-SEARCH", label:"4A — Unreasonable Search", amend:"4A", group:"4A", short:"Search" },
      { key:"4A-SEIZURE", label:"4A — Unreasonable Seizure", amend:"4A", group:"4A", short:"Seizure" },
      { key:"4A-WARRANT", label:"4A — Warrants / Probable Cause / Particularity", amend:"4A", group:"4A", short:"Warrant/PC" },

      // 5A
      { key:"5A-SILENCE", label:"5A — Self-Incrimination (Right to Remain Silent)", amend:"5A", group:"5A", short:"Self-Incrimination" },
      { key:"5A-DOUBLE", label:"5A — Double Jeopardy", amend:"5A", group:"5A", short:"Double Jeopardy" },
      { key:"5A-DUEPROCESS", label:"5A — Due Process (Federal)", amend:"5A", group:"5A", short:"Due Process (Fed)" },

      // 6A
      { key:"6A-SPEEDY", label:"6A — Speedy Trial", amend:"6A", group:"6A", short:"Speedy" },
      { key:"6A-PUBLIC", label:"6A — Public Trial", amend:"6A", group:"6A", short:"Public" },
      { key:"6A-JURY", label:"6A — Impartial Jury", amend:"6A", group:"6A", short:"Jury" },
      { key:"6A-CHARGES", label:"6A — Informed of Charges", amend:"6A", group:"6A", short:"Charges" },
      { key:"6A-CONFRONT", label:"6A — Confrontation (Cross-Examine Witnesses)", amend:"6A", group:"6A", short:"Confrontation" },
      { key:"6A-COUNSEL", label:"6A — Right to Counsel (Attorney)", amend:"6A", group:"6A", short:"Counsel" },

      // 8A
      { key:"8A-CRUEL", label:"8A — Cruel & Unusual Punishment", amend:"8A", group:"8A", short:"Cruel & Unusual" },
      { key:"8A-BAIL", label:"8A — Excessive Bail", amend:"8A", group:"8A", short:"Excessive Bail" },
      { key:"8A-FINES", label:"8A — Excessive Fines", amend:"8A", group:"8A", short:"Excessive Fines" },

      // 10A
      { key:"10A-RESERVED", label:"10A — Reserved Powers (States/People)", amend:"10A", group:"10A", short:"Reserved Powers" },

      // 14A
      { key:"14A-CITIZEN", label:"14A — Citizenship Clause", amend:"14A", group:"14A", short:"Citizenship" },
      { key:"14A-DP", label:"14A — Due Process (State)", amend:"14A", group:"14A", short:"Due Process (State)" },
      { key:"14A-EP", label:"14A — Equal Protection", amend:"14A", group:"14A", short:"Equal Protection" },
      { key:"14A-INC", label:"14A — Incorporation (BoR applies to states)", amend:"14A", group:"14A", short:"Incorporation" },

      // No Right
      { key:"NONE", label:"No Right (not a constitutional rights issue here)", amend:"NONE", group:"NONE", short:"No Right" },
    ];

    const FILTERS = [
      { id:"1A", label:"1A" },
      { id:"4A", label:"4A" },
      { id:"5A", label:"5A" },
      { id:"6A", label:"6A" },
      { id:"8A", label:"8A" },
      { id:"10A", label:"10A" },
      { id:"14A", label:"14A" },
      { id:"NONE", label:"No Right" }
    ];

    // -----------------------------
    // Question bank
    // -----------------------------
    const BANK = [
      // 1A Speech
      q("A student is suspended for wearing a shirt criticizing the principal. The school says the message is 'disrespectful.'",
        "1A-SPEECH",
        "Freedom to express opinions (speech).",
        "Government actors (public schools) can’t punish speech just because they dislike the message.",
        "A public school is a government entity; punishment tied to viewpoint triggers 1A speech analysis."
      ),
      q("City council fines a resident for criticizing the mayor at a public meeting.",
        "1A-SPEECH",
        "Freedom to speak on public issues.",
        "Government cannot punish speech based on viewpoint or criticism of officials.",
        "Speaking at a public meeting is core political speech."
      ),

      // 1A Press
      q("A public high school bans the student newspaper because it ran an article about cafeteria problems.",
        "1A-PRESS",
        "Freedom of the press to publish news and criticism.",
        "Government cannot suppress reporting solely because it is embarrassing or critical.",
        "A school-run paper is still expressive press activity; censorship is a 1A press issue."
      ),
      q("A state agency refuses to renew a media outlet’s press credentials because it 'asks hostile questions.'",
        "1A-PRESS",
        "Press freedom to gather/report information.",
        "Government can’t retaliate against media for critical coverage.",
        "Credentialing tied to favoritism becomes viewpoint-based press discrimination."
      ),

      // 1A Religion
      q("A public school requires students to recite a Christian prayer before football games.",
        "1A-RELIGION",
        "Freedom of religion (no government establishment; free exercise protections).",
        "Government may not establish/endorse a religion or coerce participation in religious practice.",
        "A public school event is state action; mandatory prayer is an Establishment problem."
      ),
      q("A city bans all religious head coverings in public buildings, including a courthouse.",
        "1A-RELIGION",
        "Free exercise of religion (religious practice).",
        "Government cannot target religious practice without strong justification and neutrality.",
        "A blanket ban burdens religious practice; it’s a free exercise issue."
      ),

      // 1A Assembly
      q("Police break up a peaceful protest in a public park because it is 'annoying to drivers,' even though it is not blocking traffic.",
        "1A-ASSEMBLY",
        "Freedom of assembly—peaceful gathering for expression.",
        "Government cannot shut down peaceful gatherings without valid, neutral time/place/manner reasons.",
        "A public park is a traditional public forum; peaceful protest is protected assembly."
      ),
      q("A town refuses permits for any gatherings of more than 10 people, but only applies it to protests against the town.",
        "1A-ASSEMBLY",
        "Freedom to assemble for political protest.",
        "Government can’t apply rules selectively to silence certain viewpoints.",
        "Selective enforcement against protest gatherings triggers assembly/free speech concerns."
      ),

      // 1A Petition
      q("A public school bans students from submitting petitions requesting a change to the dress code.",
        "1A-PETITION",
        "Right to petition government for changes/redress.",
        "Government can’t block requests/complaints simply because it dislikes being challenged.",
        "A public school is a government actor; petitioning is protected civic participation."
      ),
      q("A city refuses to accept citizen complaint forms about police conduct and tells residents to 'stop bothering us.'",
        "1A-PETITION",
        "Right to petition government for redress of grievances.",
        "Government can’t shut off the ability to ask for action or complain about official conduct.",
        "Complaints/petitions are a direct request to government—core petition right."
      ),

      // 4A Search vs Seizure vs Warrant
      q("An officer opens a student’s backpack without any specific reason—just a 'random check.'",
        "4A-SEARCH",
        "Protection from unreasonable searches.",
        "Government must have a valid justification before searching private belongings.",
        "Opening a backpack is a search; random suspicionless searches are a 4A issue."
      ),
      q("Police take a person’s phone 'for safekeeping' during a traffic stop and keep it for 3 days without a charge.",
        "4A-SEIZURE",
        "Protection from unreasonable seizure of property.",
        "Government can’t take/hold your property without lawful justification and limits.",
        "Taking the phone and holding it is a seizure; duration matters."
      ),
      q("Police enter a home to look for drugs without a warrant and without consent.",
        "4A-WARRANT",
        "Warrant/probable cause protections tied to home entry.",
        "Government generally needs a warrant supported by probable cause to search a home.",
        "Home searches are at the core of the 4A warrant requirement."
      ),
      q("A warrant says 'search the entire neighborhood for stolen items' with no specific address or items listed.",
        "4A-WARRANT",
        "Warrants must be supported by probable cause and be particular.",
        "Government can’t use general warrants to search broadly without limits.",
        "The 4A requires particularity (place/things); this is a blanket/general warrant."
      ),

      // 5A
      q("Police interrogate a suspect for hours and threaten jail time unless the suspect confesses.",
        "5A-SILENCE",
        "Protection against being compelled to incriminate yourself.",
        "Government can’t force a confession or punish someone for refusing to confess.",
        "Coercive interrogation implicates self-incrimination protections."
      ),
      q("After being acquitted of burglary, the government charges the same person again for the same burglary because prosecutors 'found new evidence.'",
        "5A-DOUBLE",
        "Protection from double jeopardy (tried twice for the same offense).",
        "Government can’t retry a person after an acquittal for the same offense.",
        "Same defendant + same offense + acquittal = double jeopardy problem."
      ),
      q("A federal agency freezes a person’s bank account permanently without any hearing or process.",
        "5A-DUEPROCESS",
        "Due process before the federal government takes liberty/property.",
        "Government must follow fair procedures before depriving someone of property.",
        "A federal action taking property without process triggers 5A due process."
      ),

      // 6A
      q("A defendant sits in jail for 18 months before trial because the court 'is busy,' with no special reason.",
        "6A-SPEEDY",
        "Right to a speedy trial.",
        "Government can’t delay criminal trials unreasonably while holding someone.",
        "Extended delay without good cause is a speedy trial issue."
      ),
      q("A judge closes a criminal trial to the public to avoid 'bad publicity' for the city.",
        "6A-PUBLIC",
        "Right to a public trial.",
        "Government can’t secretly prosecute without strong justification.",
        "Public access protects fairness; closure needs exceptional reasons."
      ),
      q("A prosecutor tries to exclude jurors of a certain race so the jury will be 'more likely to convict.'",
        "6A-JURY",
        "Right to an impartial jury.",
        "Government can’t rig jury selection to bias the outcome.",
        "Biased jury selection undermines impartial jury protections."
      ),
      q("The defendant is brought to court but is never told what crime they are charged with.",
        "6A-CHARGES",
        "Right to be informed of the nature and cause of accusations.",
        "Government must give clear notice of charges so a person can defend themselves.",
        "No notice of charges blocks defense preparation."
      ),
      q("The prosecution uses a written statement from a witness who never appears in court, so the defense can’t cross-examine.",
        "6A-CONFRONT",
        "Right to confront adverse witnesses.",
        "Government can’t rely on testimony without allowing cross-examination (with limited exceptions).",
        "No chance to question the witness triggers confrontation concerns."
      ),
      q("A poor defendant is denied a lawyer and must represent himself in a serious criminal case.",
        "6A-COUNSEL",
        "Right to counsel (attorney).",
        "Government must provide counsel in serious criminal prosecutions (and can’t block access).",
        "A criminal defendant needs an attorney to ensure a fair trial."
      ),

      // 8A
      q("A judge sets bail at $1,000,000 for a minor, nonviolent charge solely to keep the person in jail.",
        "8A-BAIL",
        "Protection against excessive bail.",
        "Government can’t set bail higher than necessary to ensure appearance/safety.",
        "Punitive bail amounts can be unconstitutional."
      ),
      q("A city fines a person $50,000 for parking tickets as a revenue tactic, far beyond the offense.",
        "8A-FINES",
        "Protection against excessive fines.",
        "Government can’t impose grossly disproportionate monetary penalties.",
        "Massive fines compared to the violation implicate excessive fines."
      ),
      q("A prison uses torture-like punishment as discipline for rule violations.",
        "8A-CRUEL",
        "Protection against cruel and unusual punishment.",
        "Government can’t impose punishments that are inhumane or grossly disproportionate.",
        "Prison conditions/punishments are government action subject to 8A limits."
      ),

      // 10A
      q("Congress orders every state to run all elections exactly the same way, including local school board elections, even though the Constitution doesn’t grant that specific power.",
        "10A-RESERVED",
        "Reserved powers: powers not delegated to the federal government are kept by states/people.",
        "Federal government can’t take powers it was never given.",
        "Election administration is often a state function unless constitutional authority applies."
      ),
      q("A federal agency creates a new statewide licensing rule for hairdressers without any clear constitutional authorization.",
        "10A-RESERVED",
        "States retain police powers for health/safety/welfare unless federal power applies.",
        "Federal power is limited to enumerated powers.",
        "Professional licensing is typically a state reserved power issue."
      ),

      // 14A
      q("A state denies citizenship to a person born in that state because their parents were immigrants.",
        "14A-CITIZEN",
        "Citizenship Clause: birthright citizenship for people born in the U.S. (with narrow exceptions).",
        "States can’t redefine citizenship to exclude people born here under U.S. jurisdiction.",
        "This is a state attempt to deny citizenship status."
      ),
      q("A state suspends a student from a public school for 30 days without any notice or chance to explain what happened.",
        "14A-DP",
        "Due process (state): fair procedures before the state deprives someone of liberty/property interests.",
        "States must provide basic fairness (notice + opportunity to be heard).",
        "Public schools are state actors; disciplinary exclusion can trigger due process."
      ),
      q("A state law allows only men to apply for certain government jobs, even if women are equally qualified.",
        "14A-EP",
        "Equal protection: states must treat similarly situated people fairly under the law.",
        "Government can’t discriminate without adequate justification.",
        "Sex-based classifications trigger equal protection analysis."
      ),
      q("A city (state government) bans criticism of government officials and arrests protestors for 'disrespect.'",
        "14A-INC",
        "Incorporation: most Bill of Rights protections apply to states through the 14th.",
        "States can’t violate incorporated rights like speech/press protections.",
        "This is a state/local action; the 1A applies via 14A incorporation."
      ),

      // No Right
      q("A private restaurant refuses to serve a customer because the customer is wearing a rival team’s jersey.",
        "NONE",
        "No direct Bill of Rights right is triggered by private action in this scenario.",
        "The Constitution restricts government action, not most private choices.",
        "This is a private business decision (state action is missing)."
      ),
      q("A teacher assigns homework on a Saturday and students complain it violates their 'rights.'",
        "NONE",
        "Not every unfair-feeling rule is a constitutional rights violation.",
        "Government can set neutral, reasonable rules that don’t target protected rights.",
        "A homework assignment alone doesn’t match a specific protected right here."
      ),
      q("A student claims the 4th Amendment was violated because a friend read their text message on the friend’s phone.",
        "NONE",
        "The 4th Amendment regulates government searches/seizures.",
        "Private people generally aren’t bound by 4A limits.",
        "This is a private interaction, not government action."
      ),

      // Mixed precision
      q("Police stop a person, handcuff them, and place them in the back of a cruiser 'just to check' even though they have no reason to believe a crime occurred.",
        "4A-SEIZURE",
        "Protection from unreasonable seizure of a person.",
        "Government must have lawful justification to restrain someone’s freedom of movement.",
        "Handcuffing/detaining is a seizure, even if no search happens."
      ),
      q("Police search a car trunk after saying, 'we don’t need any reason; we’re checking everyone tonight.'",
        "4A-SEARCH",
        "Protection from unreasonable searches.",
        "Government can’t search without an adequate justification (and sometimes a warrant/exception).",
        "Opening a trunk is a search; suspicionless searches raise 4A concerns."
      ),
      q("A judge signs a warrant based only on an anonymous rumor and no supporting evidence.",
        "4A-WARRANT",
        "Warrants require probable cause supported by facts.",
        "Government can’t issue warrants based on mere rumor or unsupported suspicion.",
        "A weak or unsupported affidavit undermines probable cause."
      ),
      q("After conviction, a judge adds an extreme punishment not authorized by law to 'make an example.'",
        "8A-CRUEL",
        "Punishment must not be cruel/unusual or grossly disproportionate.",
        "Government cannot impose inhumane or arbitrary punishment.",
        "Sentencing is government punishment; disproportionality triggers 8A concerns."
      ),
    ];

    function q(prompt, answerKey, rightProtected, limitOnGov, whyApplies){
      return { prompt, answerKey, explain: { rightProtected, limitOnGov, whyApplies } };
    }

    // -----------------------------
    // State
    // -----------------------------
    let questions = [];
    let idx = 0;
    let attemptsThis = 0;
    let attemptsTotal = 0;
    let correctThis = false;
    let correctCount = 0;

    let timerInt = null;
    let startTime = null;

    let studentName = "";
    let startISO = null;
    let finishISO = null;

    const el = (id) => document.getElementById(id);

    // UI refs
    const promptEl = el("prompt");
    const choicesEl = el("choices");
    const msgEl = el("msg");
    const explainEl = el("explain");
    const explainListEl = el("explainList");
    const qNumEl = el("qNum");
    const qTotalEl = el("qTotal");
    const attemptsQEl = el("attemptsQ");
    const attemptsTotalEl = el("attemptsTotal");
    const timerEl = el("timer");

    const restartBtn = el("restartBtn");
    const nextBtn = el("nextBtn");
    const skipBtn = el("skipBtn");

    // Name + stamps
    const overlay = el("overlay");
    const nameInput = el("studentName");
    const beginBtn = el("beginBtn");
    const nameDisplay = el("nameDisplay");
    const startStampEl = el("startStamp");
    const finishStampEl = el("finishStamp");
    const previewStart = el("previewStart");
    const previewFinish = el("previewFinish");

    // Filters
    const filterRow = el("filterRow");
    const filterState = Object.fromEntries(FILTERS.map(f => [f.id, true]));
    renderFilters();

    function renderFilters(){
      filterRow.innerHTML = "";
      FILTERS.forEach(f => {
        const lab = document.createElement("label");
        lab.className = "chk";
        const input = document.createElement("input");
        input.type = "checkbox";
        input.checked = filterState[f.id];
        input.addEventListener("change", () => {
          filterState[f.id] = input.checked;
        });
        const span = document.createElement("span");
        span.textContent = f.label;
        lab.appendChild(input);
        lab.appendChild(span);
        filterRow.appendChild(lab);
      });
    }

    function fmtLocal(iso){
      if(!iso) return "—";
      const d = new Date(iso);
      return d.toLocaleString(undefined, {
        year:"numeric", month:"2-digit", day:"2-digit",
        hour:"2-digit", minute:"2-digit", second:"2-digit"
      });
    }

    function startTimer(){
      if(timerInt) clearInterval(timerInt);
      startTime = Date.now();
      timerInt = setInterval(() => {
        const s = Math.floor((Date.now() - startTime)/1000);
        const mm = String(Math.floor(s/60)).padStart(2,"0");
        const ss = String(s%60).padStart(2,"0");
        timerEl.textContent = `${mm}:${ss}`;
      }, 250);
    }

    function stopTimer(){
      if(timerInt) clearInterval(timerInt);
      timerInt = null;
    }

    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function applyFilters(){
      const enabled = Object.entries(filterState).filter(([,v])=>v).map(([k])=>k);
      const enabledSet = new Set(enabled);

      const filtered = BANK.filter(item => {
        const t = TARGETS.find(x => x.key === item.answerKey);
        if(!t) return false;
        return enabledSet.has(t.group);
      });

      return filtered.length ? filtered : BANK.slice();
    }

    // ------------------------------------------
    // CHOICE REDUCTION: 6 buttons per question
    // Correct + 4 distractors (prefer same group)
    // + No Right (always included if enabled or if correct is NONE)
    // ------------------------------------------
    const MAX_CHOICES = 6;

    function buildChoiceSet(correctKey){
      const enabledGroups = new Set(Object.entries(filterState).filter(([,v])=>v).map(([k])=>k));
      let pool = TARGETS.filter(t => enabledGroups.has(t.group));
      if(pool.length === 0) pool = TARGETS.slice();

      const correctT = TARGETS.find(t=>t.key===correctKey);
      if(correctT && !pool.some(p=>p.key===correctKey)) pool.push(correctT);

      const noneT = TARGETS.find(t=>t.key==="NONE");
      const noneAllowed = enabledGroups.has("NONE") || correctKey === "NONE";

      const correctGroup = correctT ? correctT.group : null;

      // Prefer distractors from same group to keep precision practice tight
      let sameGroup = pool.filter(t => t.group === correctGroup && t.key !== correctKey && t.key !== "NONE");
      let otherGroup = pool.filter(t => t.group !== correctGroup && t.key !== correctKey && t.key !== "NONE");

      sameGroup = shuffle(sameGroup);
      otherGroup = shuffle(otherGroup);

      const picks = [];
      if(correctT) picks.push(correctT);

      // Fill with up to 4 distractors (prefer same group first)
      while(picks.length < 5 && sameGroup.length){
        picks.push(sameGroup.shift());
      }
      while(picks.length < 5 && otherGroup.length){
        picks.push(otherGroup.shift());
      }

      // Add No Right as last button (if allowed) and if it isn't already present
      if(noneAllowed && noneT && !picks.some(x=>x.key==="NONE")){
        // If we already have 6, drop the last distractor to make room
        if(picks.length >= MAX_CHOICES) picks.pop();
        picks.push(noneT);
      }

      // If still under MAX_CHOICES, optionally add one more distractor (rare)
      while(picks.length < MAX_CHOICES && otherGroup.length){
        const t = otherGroup.shift();
        if(!picks.some(x=>x.key===t.key)) picks.push(t);
      }

      // Shuffle display so correct isn't always first, but keep No Right at bottom
      const nr = picks.find(x=>x.key==="NONE");
      let rest = picks.filter(x=>x.key!=="NONE");
      rest = shuffle(rest);
      if(nr) rest.push(nr);

      return rest.slice(0, MAX_CHOICES);
    }

    function setMsg(type, text){
      msgEl.className = "msg" + (type ? " " + type : "");
      msgEl.textContent = text;
    }

    function renderQuestion(){
      if(idx >= questions.length){
        endScreen();
        return;
      }

      const item = questions[idx];
      attemptsThis = 0;
      correctThis = false;

      qNumEl.textContent = String(idx+1);
      qTotalEl.textContent = String(questions.length);
      attemptsQEl.textContent = "0";
      attemptsTotalEl.textContent = String(attemptsTotal);

      promptEl.textContent = item.prompt;
      explainEl.style.display = "none";
      explainListEl.innerHTML = "";
      nextBtn.disabled = true;
      setMsg("", "Choose the most precise match.");

      const choiceTargets = buildChoiceSet(item.answerKey);
      choicesEl.innerHTML = "";
      choiceTargets.forEach(t => {
        const btn = document.createElement("button");
        btn.className = "choice";
        btn.type = "button";
        btn.innerHTML = `<div><b>${t.label}</b></div><small>${t.group === "NONE" ? "Use when there is no government rights issue." : "Pick the most precise part."}</small>`;
        btn.addEventListener("click", () => handleChoice(t.key));
        choicesEl.appendChild(btn);
      });

      // Scroll back to prompt area (helps on phones)
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function handleChoice(chosenKey){
      const item = questions[idx];
      if(correctThis) return;

      if(chosenKey === item.answerKey){
        correctThis = true;
        correctCount++;
        setMsg("good", "Correct ✅  Next is unlocked.");

        explainEl.style.display = "block";
        const t = TARGETS.find(x=>x.key===item.answerKey);
        const title = t ? t.label : item.answerKey;

        explainListEl.innerHTML = "";
        addExplain(`<b>Correct sub-right/part:</b> ${title}`);
        addExplain(`<b>Right protected:</b> ${item.explain.rightProtected}`);
        addExplain(`<b>Limit on government:</b> ${item.explain.limitOnGov}`);
        addExplain(`<b>Why it applies:</b> ${item.explain.whyApplies}`);

        nextBtn.disabled = false;
      } else {
        attemptsThis++;
        attemptsTotal++;
        attemptsQEl.textContent = String(attemptsThis);
        attemptsTotalEl.textContent = String(attemptsTotal);

        const chosen = TARGETS.find(x=>x.key===chosenKey);
        const chosenLabel = chosen ? chosen.label : "That choice";
        setMsg("bad", `Not quite ❌  You chose: ${chosenLabel}. Try again (strict mode).`);
      }
    }

    function addExplain(html){
      const li = document.createElement("li");
      li.innerHTML = html;
      explainListEl.appendChild(li);
    }

    function endScreen(){
      finishISO = new Date().toISOString();
      finishStampEl.textContent = fmtLocal(finishISO);
      previewFinish.textContent = fmtLocal(finishISO);
      stopTimer();

      const totalQ = questions.length;
      const accuracy = attemptsTotal === 0 ? 100 : Math.round((totalQ / attemptsTotal) * 100);

      choicesEl.innerHTML = "";
      promptEl.innerHTML = `
        <b>Finished!</b><br/><br/>
        <div class="mono">
          Student: <b>${escapeHtml(studentName)}</b><br/>
          Start: ${fmtLocal(startISO)}<br/>
          Finish: ${fmtLocal(finishISO)}<br/>
          Elapsed: <b>${timerEl.textContent}</b><br/>
          Total Attempts: <b>${attemptsTotal}</b><br/>
          Questions: <b>${totalQ}</b><br/>
          Approx. Accuracy: <b>${accuracy}%</b>
        </div>
        <div style="margin-top:10px;color:var(--muted);font-size:12px;line-height:1.35">
          Screenshot this summary for submission.
        </div>
      `;
      setMsg("good", "Nice. Restart to reshuffle (filters apply on restart).");
      explainEl.style.display = "none";
      nextBtn.disabled = true;
    }

    function escapeHtml(str){
      return String(str).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    function restart(){
      // restart does NOT ask for name again; name stays at top
      questions = shuffle(applyFilters());
      idx = 0;
      attemptsThis = 0;
      attemptsTotal = 0;
      correctCount = 0;
      finishISO = null;
      finishStampEl.textContent = "—";
      previewFinish.textContent = "—";

      setMsg("", "Choose the most precise match.");
      startTimer();
      renderQuestion();
    }

    // Controls
    restartBtn.addEventListener("click", restart);
    nextBtn.addEventListener("click", () => {
      if(!correctThis) return;
      idx++;
      renderQuestion();
    });
    skipBtn.addEventListener("click", () => {
      idx++;
      renderQuestion();
      setMsg("warn", "Teacher skip used. (No credit awarded.)");
    });

    // Name overlay flow
    beginBtn.addEventListener("click", beginGame);
    nameInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter") beginGame();
    });

    function beginGame(){
      const v = nameInput.value.trim();
      if(!v){
        alert("Please enter your name.");
        nameInput.focus();
        return;
      }
      studentName = v;
      nameDisplay.textContent = studentName;

      startISO = new Date().toISOString();
      startStampEl.textContent = fmtLocal(startISO);
      previewStart.textContent = fmtLocal(startISO);

      overlay.style.display = "none";

      // Start game
      restart();
    }

    // Boot: show overlay first
    overlay.style.display = "flex";
  </script>
</body>
</html>

