<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bill of Rights — Right or No Right?</title>
  <style>
    :root{
      --bg:#0b1220;
      --text:#e7eefc;
      --muted:#a8b4cf;
      --border: rgba(255,255,255,0.10);
      --shadow: 0 18px 55px rgba(0,0,0,.35);
      --radius: 18px;
      --radius2: 14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --good:#2bd576;
      --bad:#ff5c7a;
      --warn:#ffd166;
      --accent:#7aa2ff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: var(--sans);
      background: radial-gradient(900px 500px at 15% 15%, rgba(122,162,255,.18), transparent 60%),
                  radial-gradient(900px 500px at 85% 25%, rgba(43,213,118,.14), transparent 60%),
                  radial-gradient(900px 500px at 60% 85%, rgba(255,92,122,.12), transparent 60%),
                  var(--bg);
      color: var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
    }
    .app{
      width:min(1040px,100%);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--border);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      overflow:hidden;
    }
    header{
      padding:18px 18px 14px;
      border-bottom:1px solid var(--border);
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    h1{margin:0;font-size:20px;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px;line-height:1.25;max-width:720px}

    .stats{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      border-radius:999px;
      padding:8px 10px;
      font-size:12px;
      color:var(--muted);
      display:flex;
      gap:6px;
      align-items:center;
      white-space:nowrap;
    }
    .pill b{color:var(--text);font-weight:700}

    main{
      padding:18px;
      display:grid;
      grid-template-columns: 1.08fr .92fr;
      gap:14px;
    }
    @media (max-width:900px){ main{grid-template-columns:1fr} }

    .card{
      background: rgba(0,0,0,.18);
      border:1px solid var(--border);
      border-radius: var(--radius2);
      padding:14px;
    }

    .scenario{
      background: linear-gradient(180deg, rgba(122,162,255,.10), rgba(0,0,0,.18));
      border:1px solid rgba(122,162,255,.22);
      border-radius: var(--radius2);
      padding:16px;
      min-height:170px;
      display:flex;
      flex-direction:column;
      gap:10px;
      position:relative;
      overflow:hidden;
    }
    .scenario::after{
      content:"";
      position:absolute;
      inset:-60px -80px auto auto;
      width:240px;height:240px;
      background: radial-gradient(circle, rgba(122,162,255,.22), transparent 60%);
      transform: rotate(18deg);
    }
    .scenario-label{
      font-family:var(--mono);
      font-size:11px;
      color: rgba(231,238,252,.75);
      letter-spacing:.6px;
      text-transform:uppercase;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      position:relative;
      z-index:1;
    }
    .badge{
      font-family:var(--mono);
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      border:1px solid var(--border);
      color:var(--muted);
      background: rgba(0,0,0,.18);
      white-space:nowrap;
    }
    .scenario-text{
      font-size:17px;
      line-height:1.35;
      margin:0;
      position:relative;
      z-index:1;
    }

    .choices{
      display:grid;
      gap:10px;
      margin-top:12px;
    }
    .choices.grid2{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    .choices.grid3{ grid-template-columns: repeat(3, minmax(0,1fr)); }
    @media (max-width:540px){
      .choices.grid3{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }

    button{
      appearance:none;
      border:1px solid var(--border);
      background: rgba(0,0,0,.20);
      color: var(--text);
      padding: 12px 10px;
      border-radius: 14px;
      font-size: 14px;
      cursor:pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    button:hover{ background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.16); }
    button:active{ transform: translateY(1px); }
    button.primary{ border-color: rgba(122,162,255,.35); background: rgba(122,162,255,.12); }
    button.good{ border-color: rgba(43,213,118,.40); background: rgba(43,213,118,.14); }
    button.bad{ border-color: rgba(255,92,122,.35); background: rgba(255,92,122,.12); }
    button:disabled{opacity:.55;cursor:not-allowed;transform:none}

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }

    .feedback{
      margin-top:10px;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      min-height:54px;
      display:flex;
      align-items:flex-start;
      gap:10px;
    }
    .feedback .icon{
      width:18px;height:18px;border-radius:6px;
      display:inline-flex;align-items:center;justify-content:center;
      font-weight:900;font-size:12px;margin-top:2px;flex:0 0 auto;
    }
    .icon.good{ background: rgba(43,213,118,.16); color: var(--good); border:1px solid rgba(43,213,118,.35); }
    .icon.bad{ background: rgba(255,92,122,.16); color: var(--bad); border:1px solid rgba(255,92,122,.35); }
    .icon.warn{ background: rgba(255,209,102,.16); color: var(--warn); border:1px solid rgba(255,209,102,.35); }

    .explain{
      margin-top:12px;
      display:none;
      border-radius:14px;
      border:1px solid rgba(43,213,118,.30);
      background: linear-gradient(180deg, rgba(43,213,118,.10), rgba(0,0,0,.18));
      padding:12px;
    }
    .explain h3{ margin:0 0 8px; font-size:14px; }
    .explain .grid{
      display:grid;
      grid-template-columns:1fr;
      gap:8px;
      color: var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    .explain b{ color: var(--text); }
    .mini{
      font-family:var(--mono);
      font-size:11px;
      color: rgba(231,238,252,.70);
      margin-top:8px;
    }

    .sidebar h2{margin:0 0 10px;font-size:15px}
    .help{color:var(--muted);font-size:13px;line-height:1.35;margin:0 0 12px}

    .rulebox{
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .rule{display:flex;gap:10px;align-items:flex-start}
    .dot{
      width:10px;height:10px;border-radius:3px;margin-top:5px;flex:0 0 auto;
      border:1px solid var(--border);
      background: rgba(122,162,255,.22);
      border-color: rgba(122,162,255,.32);
    }

    .footer{
      padding:14px 18px 18px;
      border-top:1px solid var(--border);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
      color: var(--muted);
      font-size: 12px;
    }
    .linkish{color: rgba(231,238,252,.75); text-decoration: underline; cursor:pointer;}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Bill of Rights — Right or No Right?</h1>
        <div class="sub">
          Step 1: Decide if the government action is <b>Constitutional</b> (Allowed) or <b>Unconstitutional</b> (Violation).<br/>
          Step 2: Identify the amendment. You can’t advance until you get both steps correct.
        </div>
      </div>

      <div class="stats">
        <div class="pill">Scenario <b id="qNum">1</b>/<b id="qTotal">0</b></div>
        <div class="pill">Correct Chains <b id="correctCt">0</b></div>
        <div class="pill">Total Attempts <b id="attemptCt">0</b></div>
        <div class="pill">This Scenario Attempts <b id="attemptThis">0</b></div>
        <div class="pill">Timer <b id="timeEl">0:00</b></div>
        <div class="pill">Now <b id="nowStamp">—</b></div>
        <div class="pill">Started <b id="startStamp">—</b></div>
      </div>
    </header>

    <main>
      <section class="card">
        <div class="scenario">
          <div class="scenario-label">
            <span class="badge" id="stageBadge">Stage: 1/2</span>
            <span class="badge" id="attemptBadge">Attempt #: 0</span>
            <span class="badge" id="streakBadge">Streak: 0</span>
          </div>
          <p class="scenario-text" id="scenarioText">Loading…</p>
        </div>

        <div class="choices grid2" id="stage1Choices"></div>
        <div class="choices grid3" id="stage2Choices" style="display:none"></div>

        <div class="controls">
          <button class="primary" id="btnHint">Hint</button>
          <button id="btnSkip">Teacher Skip</button>
          <button id="btnRestart">Restart</button>
          <button class="good" id="btnNext" style="display:none">Next Scenario</button>
        </div>

        <div class="feedback" id="feedback">
          <span class="icon warn">!</span>
          <div>
            <div><b>Directions:</b> Stage 1 first — Constitutional or Unconstitutional.</div>
            <div style="margin-top:4px">Then identify the amendment in Stage 2.</div>
          </div>
        </div>

        <div class="explain" id="explainBox">
          <h3 id="explainTitle">Explanation</h3>
          <div class="grid" id="explainGrid"></div>
          <div class="mini" id="explainMini"></div>
        </div>
      </section>

      <aside class="card sidebar">
        <h2>How to think like OST</h2>
        <p class="help">
          Rights are protected, but government can sometimes regulate time/place/manner, safety, and order.
          This game forces you to decide: Allowed vs Violation, then name the amendment.
        </p>

        <div class="rulebox">
          <div class="rule"><span class="dot"></span><div><b>Allowed:</b> regulation is neutral, narrow, tied to safety/order (e.g., noise limits, permit requirements that aren’t used to shut speech down).</div></div>
          <div class="rule"><span class="dot"></span><div><b>Violation:</b> government targets a viewpoint, censors criticism, searches without legal basis, forces confession, denies counsel, or uses cruel/excessive punishment.</div></div>
        </div>

        <div style="height:12px"></div>

        <h2>Teacher Tip</h2>
        <p class="help">
          Pause after a scenario and have students name:
          (1) government action, (2) right involved, (3) limit on government.
        </p>
      </aside>
    </main>

    <div class="footer">
      <div>Game 2 • no logins • no data saved</div>
      <div><span class="linkish" id="toggleShuffle">Shuffle: ON</span></div>
    </div>
  </div>

  <script>
    /**********************
     * SAFE INIT (repaired)
     **********************/
    function safeInit(){
      try {
        init();
      } catch (err) {
        const box = document.getElementById("scenarioText");
        box.textContent = "Error loading game: " + (err?.message || err);
        console.error(err);
      }
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", safeInit);
    } else {
      safeInit();
    }

    /**********************
     * DATA + STATE
     **********************/
    const AMENDMENTS = [
      { key:"1", label:"1st" },
      { key:"2", label:"2nd" },
      { key:"4", label:"4th" },
      { key:"5", label:"5th" },
      { key:"6", label:"6th" },
      { key:"8", label:"8th" },
      { key:"10", label:"10th" },
    ];

    const JUDGMENTS = [
      { key:"constitutional", label:"Constitutional (Allowed)", cls:"good" },
      { key:"unconstitutional", label:"Unconstitutional (Violation)", cls:"bad" },
    ];

    // Scenario bank: clear cases first (minimize debates)
    const scenarioBank = [
      {
        scenario: "A city requires a permit for a large march downtown to coordinate traffic and public safety, and it approves permits using the same rules for all groups.",
        judgment: "constitutional",
        amendment: "1",
        right: "Freedom of assembly (and speech).",
        limit: "Government may use neutral time/place/manner rules for safety as long as it isn’t targeting viewpoints or effectively banning the right.",
        why: "This is a neutral, safety-based permit system applied equally."
      },
      {
        scenario: "A student is suspended for peacefully criticizing school policy, even though the speech does not disrupt learning.",
        judgment: "unconstitutional",
        amendment: "1",
        right: "Freedom of speech.",
        limit: "Government cannot punish speech simply because it dislikes the message (especially without disruption).",
        why: "This is retaliation for expression rather than preventing disruption."
      },
      {
        scenario: "A law bans all law-abiding adults from possessing any firearms in their homes for self-defense.",
        judgment: "unconstitutional",
        amendment: "2",
        right: "Right to keep and bear arms.",
        limit: "Government may regulate firearms, but a total ban on lawful home possession for self-defense raises major constitutional concerns.",
        why: "This is a sweeping prohibition on lawful possession for self-defense."
      },
      {
        scenario: "Police enter a home and search bedrooms and closets without a warrant and without an emergency situation.",
        judgment: "unconstitutional",
        amendment: "4",
        right: "Protection against unreasonable searches and seizures.",
        limit: "Government generally needs a warrant based on probable cause to search a home (with limited exceptions).",
        why: "This is a warrantless home search with no valid exception."
      },
      {
        scenario: "Police obtain a search warrant from a judge based on probable cause and then search the suspect’s home for evidence listed in the warrant.",
        judgment: "constitutional",
        amendment: "4",
        right: "Protection against unreasonable searches and seizures.",
        limit: "Searches are generally lawful when supported by probable cause and a valid warrant describing what may be searched/seized.",
        why: "This follows the warrant + probable cause requirement."
      },
      {
        scenario: "After a jury finds a defendant not guilty, prosecutors try to put the same person on trial again for the same offense.",
        judgment: "unconstitutional",
        amendment: "5",
        right: "Protection against double jeopardy.",
        limit: "Government cannot try someone twice for the same offense after acquittal.",
        why: "A second prosecution after acquittal violates double jeopardy."
      },
      {
        scenario: "During questioning, police threaten a suspect with serious harm unless he confesses, and he signs a confession to make it stop.",
        judgment: "unconstitutional",
        amendment: "5",
        right: "Protection against self-incrimination (and due process).",
        limit: "Government cannot compel a person to incriminate themselves through coercion.",
        why: "The confession is forced rather than voluntary."
      },
      {
        scenario: "A defendant is tried for a serious crime but is not allowed a lawyer even though he cannot afford one.",
        judgment: "unconstitutional",
        amendment: "6",
        right: "Right to counsel.",
        limit: "Government must provide counsel in serious criminal cases when defendants cannot afford an attorney.",
        why: "Denial of counsel undermines a fair criminal trial."
      },
      {
        scenario: "At trial, the judge refuses to let the defense question the main witness who accused the defendant.",
        judgment: "unconstitutional",
        amendment: "6",
        right: "Right to confront witnesses.",
        limit: "Defendants must be able to confront and cross-examine adverse witnesses in criminal trials.",
        why: "Blocking confrontation prevents testing witness reliability."
      },
      {
        scenario: "A judge sets bail extremely high for a minor nonviolent offense, clearly to keep the accused jailed before trial.",
        judgment: "unconstitutional",
        amendment: "8",
        right: "Protection against excessive bail.",
        limit: "Bail cannot be excessive relative to the circumstances; it cannot be used as punishment before conviction.",
        why: "The bail amount is being used to punish rather than ensure court appearance."
      },
      {
        scenario: "The federal government orders states to run local public schools in a specific way even though the Constitution does not delegate that power to the federal government.",
        judgment: "unconstitutional",
        amendment: "10",
        right: "Reserved powers to the states or the people.",
        limit: "Powers not delegated to the federal government are reserved to the states or the people.",
        why: "This is a federal command outside a delegated power area."
      }
    ];

    let deck = [];
    let idx = 0;

    let stage = 1;              // 1=judgment, 2=amendment
    let totalAttempts = 0;
    let scenarioAttempts = 0;
    let streak = 0;
    let correctChains = 0;

    let shuffleOn = true;

    // Timer
    let sessionStart = new Date();
    let startTs = Date.now();
    let timerId = null;
    let nowId = null;

    const el = (id) => document.getElementById(id);

    function init(){
      buildDeck();
      el("qTotal").textContent = String(scenarioBank.length);

      el("startStamp").textContent = fmtDateTime(sessionStart);
      el("nowStamp").textContent = fmtDateTime(new Date());

      renderButtons();
      wireUI();
      startTimers();
      render();
    }

    function wireUI(){
      el("btnHint").onclick = showHint;
      el("btnSkip").onclick = teacherSkip;
      el("btnRestart").onclick = restart;
      el("btnNext").onclick = nextScenario;
      el("toggleShuffle").onclick = toggleShuffle;
    }

    function buildDeck(){
      deck = [...scenarioBank];
      if(shuffleOn){
        for(let k = deck.length-1; k>0; k--){
          const j = Math.floor(Math.random()*(k+1));
          [deck[k], deck[j]] = [deck[j], deck[k]];
        }
      }
    }

    function renderButtons(){
      const s1 = el("stage1Choices");
      s1.innerHTML = "";
      JUDGMENTS.forEach(opt=>{
        const b = document.createElement("button");
        b.className = opt.cls;
        b.textContent = opt.label;
        b.onclick = () => answerStage1(opt.key);
        s1.appendChild(b);
      });

      const s2 = el("stage2Choices");
      s2.innerHTML = "";
      AMENDMENTS.forEach(a=>{
        const b = document.createElement("button");
        b.className = "primary";
        b.textContent = a.label;
        b.onclick = () => answerStage2(a.key);
        s2.appendChild(b);
      });
    }

    function render(){
      const card = deck[idx];

      stage = 1;
      scenarioAttempts = 0;

      el("scenarioText").textContent = card.scenario;

      el("stageBadge").textContent = "Stage: 1/2";
      el("attemptBadge").textContent = "Attempt #: 0";
      el("streakBadge").textContent = `Streak: ${streak}`;

      el("stage1Choices").style.display = "grid";
      el("stage2Choices").style.display = "none";
      el("btnNext").style.display = "none";
      el("explainBox").style.display = "none";

      setFeedback("warn","Directions","Stage 1: Decide if the government action is Constitutional (Allowed) or Unconstitutional (Violation).");
      updateStats();
    }

    function updateStats(){
      el("qNum").textContent = String(idx+1);
      el("correctCt").textContent = String(correctChains);
      el("attemptCt").textContent = String(totalAttempts);
      el("attemptThis").textContent = String(scenarioAttempts);
      el("attemptBadge").textContent = `Attempt #: ${scenarioAttempts}`;
      el("streakBadge").textContent = `Streak: ${streak}`;
    }

    function answerStage1(choice){
      const card = deck[idx];
      totalAttempts++;
      scenarioAttempts++;
      updateStats();

      if(choice === card.judgment){
        stage = 2;
        el("stageBadge").textContent = "Stage: 2/2";
        el("stage1Choices").style.display = "none";
        el("stage2Choices").style.display = "grid";
        setFeedback("good","Stage 1 Correct","Now Stage 2: Which amendment best applies?");
      } else {
        streak = 0;
        setFeedback("bad","Try again","Ask: Is this a neutral safety/order rule (allowed), or is government punishing/banning a right (violation)?");
      }
      updateStats();
    }

    function answerStage2(choice){
      const card = deck[idx];
      totalAttempts++;
      scenarioAttempts++;
      updateStats();

      if(choice === card.amendment){
        correctChains++;
        streak++;
        setFeedback("good","Correct Chain!","You got both steps correct. Read the explanation, then click Next.");
        showExplanation(card);
        el("btnNext").style.display = "inline-block";
      } else {
        streak = 0;
        setFeedback("bad","Not that amendment","Identify the RIGHT involved, then match the amendment that limits government in this situation.");
      }
      updateStats();
    }

    function showExplanation(card){
      el("explainBox").style.display = "block";
      el("explainTitle").textContent = `Explanation: ${card.amendment}${suffix(card.amendment)} Amendment`;
      el("explainGrid").innerHTML = `
        <div><b>Judgment:</b> ${card.judgment === "constitutional" ? "Constitutional (Allowed)" : "Unconstitutional (Violation)"}</div>
        <div><b>Right Protected:</b> ${escapeHtml(card.right)}</div>
        <div><b>Limit on Government:</b> ${escapeHtml(card.limit)}</div>
        <div><b>Why this applies:</b> ${escapeHtml(card.why)}</div>
      `;
      el("explainMini").textContent = "OST habit: Allowed vs violation → name the right → state the limit on government.";
    }

    function showHint(){
      const card = deck[idx];
      const t = card.scenario.toLowerCase();

      let hint = "Hint: Identify the government action first. Then identify the right involved.";
      if(t.includes("permit") || t.includes("march") || t.includes("protest") || t.includes("speech") || t.includes("religion")) hint = "Hint: Speech/press/religion/assembly/petition = 1st Amendment logic.";
      if(t.includes("firearms") || t.includes("gun")) hint = "Hint: Firearms rules = 2nd Amendment logic.";
      if(t.includes("warrant") || t.includes("search") || t.includes("enter") || t.includes("home")) hint = "Hint: Warrant/probable cause/search = 4th Amendment logic.";
      if(t.includes("confess") || t.includes("not guilty") || t.includes("twice")) hint = "Hint: Forced confession or second trial = 5th Amendment logic.";
      if(t.includes("lawyer") || t.includes("trial") || t.includes("witness") || t.includes("jury")) hint = "Hint: Trial rights = 6th Amendment logic.";
      if(t.includes("bail") || t.includes("punishment") || t.includes("prison")) hint = "Hint: Excessive bail / cruel punishment = 8th Amendment logic.";
      if(t.includes("states") || t.includes("not delegate") || t.includes("reserved") || t.includes("federal")) hint = "Hint: Reserved powers = 10th Amendment logic.";

      setFeedback("warn","Hint",hint);
    }

    function nextScenario(){
      if(idx < deck.length - 1){
        idx++;
        render();
      } else {
        finish();
      }
    }

    function teacherSkip(){
      if(idx < deck.length - 1){
        idx++;
        render();
      } else {
        finish();
      }
    }

    function finish(){
      el("stage1Choices").style.display = "none";
      el("stage2Choices").style.display = "none";
      el("btnNext").style.display = "none";
      el("btnHint").disabled = true;

      const elapsed = fmtTime(Date.now() - startTs);
      setFeedback("good","Session Complete",`Correct chains: ${correctChains} • Attempts: ${totalAttempts} • Time: ${elapsed}. Click Restart to replay.`);

      el("scenarioText").textContent = "Finish! Great work — replay for higher accuracy and fewer attempts.";
      el("explainBox").style.display = "block";
      el("explainTitle").textContent = "Next step";
      el("explainGrid").innerHTML = `
        <div><b>Goal:</b> 2 strong runs to build fluency (fewer attempts).</div>
        <div><b>Next game:</b> Game 3 will ask you to “Fix the Violation.”</div>
      `;
      el("explainMini").textContent = "Teacher note: add more scenarios in scenarioBank.";
    }

    function restart(){
      idx = 0;
      totalAttempts = 0;
      scenarioAttempts = 0;
      streak = 0;
      correctChains = 0;

      sessionStart = new Date();
      startTs = Date.now();
      el("startStamp").textContent = fmtDateTime(sessionStart);

      el("btnHint").disabled = false;

      buildDeck();
      render();
    }

    function toggleShuffle(){
      shuffleOn = !shuffleOn;
      el("toggleShuffle").textContent = `Shuffle: ${shuffleOn ? "ON" : "OFF"}`;
      restart();
    }

    function setFeedback(kind,title,msg){
      const box = el("feedback");
      box.innerHTML = "";

      const icon = document.createElement("span");
      icon.className = `icon ${kind}`;
      icon.textContent = kind === "good" ? "✓" : kind === "bad" ? "✕" : "!";

      const wrap = document.createElement("div");
      wrap.innerHTML = `<div><b>${escapeHtml(title)}</b></div><div style="margin-top:4px">${escapeHtml(msg)}</div>`;

      box.appendChild(icon);
      box.appendChild(wrap);
    }

    function startTimers(){
      if(timerId) clearInterval(timerId);
      timerId = setInterval(()=> el("timeEl").textContent = fmtTime(Date.now() - startTs), 500);

      if(nowId) clearInterval(nowId);
      nowId = setInterval(()=> el("nowStamp").textContent = fmtDateTime(new Date()), 1000);
    }

    function fmtTime(ms){
      const s = Math.floor(ms/1000);
      const m = Math.floor(s/60);
      const r = s % 60;
      return `${m}:${String(r).padStart(2,"0")}`;
    }

    function fmtDateTime(d){
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      let hh = d.getHours();
      const ampm = hh >= 12 ? "PM" : "AM";
      hh = hh % 12; if(hh===0) hh = 12;
      const mi = String(d.getMinutes()).padStart(2,"0");
      const ss = String(d.getSeconds()).padStart(2,"0");
      return `${mm}/${dd}/${yyyy} ${hh}:${mi}:${ss} ${ampm}`;
    }

    function escapeHtml(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function suffix(n){
      if(n==="1") return "st";
      if(n==="2") return "nd";
      if(n==="3") return "rd";
      return "th";
    }
  </script>
</body>
</html>

